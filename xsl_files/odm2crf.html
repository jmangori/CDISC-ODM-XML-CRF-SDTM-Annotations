<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
  Copyright (c) 2021 Jørgen Mangor Iversen

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>ODM2CRF</title>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="Author" content="Jørgen Mangor Iversen">
    <style>
      *                { font-family: Helvetica, Arial, sans-serif !important; }
      input[type=file] { width: 50em; size: 50em; border: 0; }
      .center          { margin-left: auto; margin-right: auto; }
      .anno            { background-color: LightYellow; }
    </style>
    <script>
      function valform() {
        for (var element of document.forms["parms"]) {
          element.value = element.value.replace(/\s/g, '');
        }
      }
    </script>
  </head>
  <body>
    <h1>ODM 2 CRF rendition demo</h1>
    <h2>General</h2>
    This page applies to metadata handling related to data capture of clinical trials in the pharmaceutical industry.
    This page converts a valid ODM-XML document version 1.3.2 to a rendition of the CRF from that ODM-XML document, with or without SDTM annotations.
    The rendition is perfommed mostly via a XSLT translating style sheet applied to the ODM-XML file, with only a few global additions to the header of CRF pages.
    The focus on SDTM annotations over other annotations stems from the fact that a SDTM annotated CRF is a submission requirement from regulatory authorities such as FDA and PMDA, while the other annotations are not.
    <h2>Usage</h2>
    Chose a valid ODM-XML version 1.3.2 document from your local disk, and generate either a blank CRF or a SDTM annotated CRF in the browser.
    If the selected ODM-XML document is not valid, a blank screen is displayed.
    Turn on your browsers Developer Tools, specifically the console, to verify if necessary.
    <p/>
    Add an optional company name and an optional image file of the company logo to be part of the generated CRF pages.
    Default values for SDTM annotations of the header information of each CRF page can be changed.
    If any SDTM annotation is left blank, the corresponding field will be omitted from the generated CRF.
    However, better display result can be achieved by modifying the necessary XSL file downloaded from <a href="https://github.com/jmangori/CDISC-ODM-XML-CRF-SDTM-Annotations">GitHub</a>.
    <p/>
    Saving the resulting web page as a complete web page delivers the CRF as HTML, including a subfolder for the logo image file, if specified.
    Other formats for saving files delivers the HTML file used to drive the XSLT rendition.
    <form name="parms" action="odm2crf.php" onsubmit="return valform()" method="post" enctype="multipart/form-data">
      <table border="0" class="center">
        <tr>
          <td></td>
          <td><h2>Selection</h2></td>
        </tr>
        <tr>
          <td>ODM-XML file:<input type="hidden" name="MAX_FILE_SIZE" value="6291455"/></td>
          <td><input type="file" name="parmxml" size="50" required accept=".xml"/></td>
        </tr>
        <tr>
          <td>SDTM annotations:</td>
          <td>
            <input type="hidden" name="parmxsl" value="crf_1_3_2.xsl">
            <input type="radio" name="parmanno" id="acrf" value="acrf" checked>
            <label for="acrf">SDTM annotated CRF (acrf)</label>
            <br>
            <input type="radio" name="parmanno" id="bcrf" value="bcrf">
            <label for="bcrf">Blank CRF (bcrf)</label>
          </td>
        </tr>
        <tr>
          <td></td>
          <td><h3>Parameters for the CRF</h3></td>
        </tr>
        <tr>
          <td>Company Name:</td>
          <td><input type="text" name="parmname" value="Company Name"/></td>
        </tr>
        <tr>
          <td>Company Logo (png):</td>
          <td><input type="file" name="parmlogo" size="50" accept=".png, .gif,.jpg, .jpeg"/></td>
        </tr>
        <tr>
          <td></td>
          <td><h4>SDTM Annotations for the CRF page header</h3></td>
        </tr>
        <tr>
          <td>Study/Trial Name:</td>
          <td><input type="text" name="parmstudy" class="anno" value="DM.STUDYID"/></td>
        </tr>
        <tr>
          <td>Site Number:</td>
          <td><input type="text" name="parmsite" class="anno" value="DM.SITEID"/></td>
        </tr>
        <tr>
          <td>Investigator:</td>
          <td><input type="text" name="parminv" class="anno" value="NOT SUBMITTED"/></td>
        </tr>
        <tr>
          <td>Subject Number:</td>
          <td><input type="text" name="parmsubject" class="anno" value="DM.SUBJID"/></td>
        </tr>
        <tr>
          <td>Subject Initials:</td>
          <td><input type="text" name="parminit" class="anno" value="NOT SUBMITTED"/></td>
        </tr>
        <tr>
          <td>Visit:</td>
          <td><input type="text" name="parmvisit" class="anno" value="SV.VISIT"/></td>
        </tr>
        <tr>
          <td></td>
          <td><h3>Rendition</h2></td>
        </tr>
          <td></td>
          <td><input type="submit" name="submit" value="ODM 2 CRF rendition"/></td>
        </tr>
      </table>
    </form>
    <h2>CRF layout</h2>
    The main benefit of creating the CRF directly from the ODM-XML file, is to avoid manually converting the same information from the ODM-XML file to CRF pages, adding no real value to the execution of clinical trials.
    <p/>
    The main feature of the CRF layout presented here is to put the SDTM annotations in a column adjacent to each question line.
    This way, the SDTM annotations are displayed at the proper location, but without the need to move boxes of annotations around inside and on top of CRF elements.
    <h2>Creating PDF documents</h2>
    In all browsers, print the CRF renditions as PDF documents on your disk as either <a href="bcrf.pdf" title="Blank CRF example">bcrf.pdf</a> or <a href="acrf.pdf" title="SDTM Annotated CRF example">acrf.pdf</a> submission documents, respectively.
    Please note:
    <ul>
      <li>The on-screen buttons are not included in PDF documents created by printing to a PDF file.</li>
      <li>The TOC will work correctly as links within the PDF documents.</li>
      <li>Form names in the visit matrix works as links as well.</li>
      <li>The yellow background color of the SDTM annotations requires printing of background graphics to be part of PDF documents.</li>
      <li>Headers and footers, portrait versus landscape, and other document properties can be controlled within the printing dialog of your browser.</li>
    </ul>
    <h2>Design choises</h2>
    All vendor specific name spaces and XML addendums to the ODM-XML file are ignored.
    <ul>
      <li>
        The following assumptions regarding the specifics of the ODM-XML file's XPATH's are in effect:
        <dl>
          <dt>CRF instructions</dt>
          <dd>/ODM/Study/MetaDataVersion/FormDef/Description/TranslatedText</dd>
          <dt>Question instructions</dt>
          <dd>/ODM/Study/MetaDataVersion/ItemDef/Description/TranslatedText</dd>
          <dt>SDTM Annotations</dt>
          <dd>/ODM/Study/MetaDataVersion/ItemDef/Alias/@Name<br/><em>where</em><br>/ODM/Study/MetaDataVersion/ItemDef/Alias/@Context='SDTM'</dd>
        </dl>
      </li>
      <li>
        Groups (ItemGroup tags) in the ODM-XML are not displayed as part of the CRF rendition.
        They are used solely to cary the SDTM domain dataset name in the @Domain attribute.
      </li>
      <li>
        The layout of the CRF is taken from the examples on the CDISC website.
        I have made very few design choises of my own.
        These do include a cleanup of the SDTM annotations, such as
        <ul>
          <li>All text constants are enclosed in quotation marks.</li>
          <li>Consistent use of single quotation marks in the SDTM annotations.</li>
          <li>Ommision of table border for additions to the CRF itself.</li>
          <li>Addition of a reference number for each CRF question. This has proved usefull when revieving CRFs.</li>
          <li>Instructions/notes are written using a smaller font and in italics.</li>
        </ul>
      </li>
    </ul>
    <h2>Privacy</h2>
    No documents are uploaded to, or retained on, the server, as all processing takes place within your browser.
    The [Choose File] button loads the ODM-XML file into your browser, not onto any server.
    The server is merely an instrument for pairing the ODM-XML file with the XSLT translating style sheet.
    <h2>Reference</h2>
    <ul>
      <li>To read more, and to obtain a copy of the XSLT translating style sheet source code, go to my repository on <a href="https://github.com/jmangori/CDISC-ODM-XML-CRF-SDTM-Annotations">GitHub</a>.</li>
      <li>
        To learn more about the CRF examples used to specify the XSLT translating style sheets, go to the <a href="https://www.cdisc.org/">CDISC</a> website and searc for CRF.
        Membership of CDISC is required.
      </li>
    </ul>
  </body>
</html>
